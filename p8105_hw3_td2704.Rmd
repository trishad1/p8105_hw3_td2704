---
title: "P8105 Homework 3 [td2704]"
output: github_document
---


```{r, echo=FALSE, message=FALSE}

library(tidyverse)
library(readxl)
library(lubridate)
library(dplyr)
library(p8105.datasets)

# knitr::opts_chunk$set(
#   fig.width = 6,
#   fig.asp = .6,
#   out.width = "90%"
# )

```


## Problem 1

```{r}

data("instacart")

```


```{r}

instacart

```

### Describing the instacart dataset.

The instacart dataset has `r nrow(instacart)` rows of `r length(colnames(instacart))`
variables: `r colnames(instacart)`. It is a tibble that lists products in each
order with an associated order_number and user_id, along with other order info
such as when they last ordered and what time this order was placed. It covers
a range of `r length(unique(pull(instacart,product_id)))` products in 
`r length(unique(pull(instacart,department)))` departments from 
`r length(unique(pull(instacart,order_id)))` orders by `r length(unique(pull(instacart,user_id)))` 
users. For example, the first row of the dataset describes `r pull(instacart[1,],product_name)`
from order `r pull(instacart[1,],order_id)` by user `r pull(instacart[1,],user_id)`; it is
described to be in the `r pull(instacart[1,],aisle)` aisle in the `r pull(instacart[1,],department)`
department. It was added to cart by user `r pull(instacart[1,],user_id)` `r pull(instacart[1,],add_to_cart_order)`
time(s); and it had been `r pull(instacart[1,],days_since_prior_order)` days since this user
last ordered. As another example of a row of data in this dataset, the 10th row of the dataset describes `r pull(instacart[10,],product_name)` from order `r pull(instacart[10,],order_id)` by user `r pull(instacart[10,],user_id)`; it is described to be in the `r pull(instacart[10,],aisle)` 
aisle in the `r pull(instacart[10,],department)` department. It was added to cart by user `r pull(instacart[10,],user_id)` `r pull(instacart[10,],add_to_cart_order)` time(s); 
and it had been `r pull(instacart[10,],days_since_prior_order)` days since this user
last ordered.


### How many aisles are there, and which aisles are the most items ordered from?

There are `r length(unique(pull(instacart,aisle)))` aisles in this dataset.

```{r}

aisle_info = 
  instacart %>%
  group_by(aisle, aisle_id) %>%
  count(aisle) %>%
  arrange(desc(n)) %>%
  rename(num_items_ordered = n)
  
sum(pull(aisle_info,num_items_ordered)) # to make sure we total the number of rows in dataset

aisle_info
  

```

It seems to be that the top 5 aisles most ordered from are `r pull(head(aisle_info,5),aisle)`.


### Make a plot that shows the number of items ordered in each aisle, limiting this to aisles with more than 10000 items ordered. Arrange aisles sensibly, and organize your plot so others can read it.

We can use our aisle_info dataframe from above for this.

```{r}

aisle_info %>%
  filter(num_items_ordered > 10000) %>%
  ggplot(aes(x=num_items_ordered, y=reorder(aisle, num_items_ordered))) +
  geom_bar(stat='identity') + 
  ggtitle("Number of items ordered in each aisle (more than 10000)") +
  xlab("Number items ordered") + ylab("Aisle name")

```


### Make a table showing the three most popular items in each of the aisles “baking ingredients”, “dog food care”, and “packaged vegetables fruits”. Include the number of times each item is ordered in your table.

```{r}

instacart %>%
  filter(aisle == "baking ingredients" | aisle == "dog food care" | aisle == "packaged vegetables fruits") %>%
  group_by(aisle, aisle_id,product_name, product_id) %>%
  count(product_name) %>%
  rename(num_items_ordered=n) %>%
  arrange(desc(num_items_ordered)) %>%
  group_by(aisle) %>%
  slice_max(num_items_ordered,n=3) %>%
  arrange(desc(num_items_ordered)) %>%
  knitr::kable()

```

### Make a table showing the mean hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered on each day of the week; format this table for human readers (i.e. produce a 2 x 7 table).

```{r}

instacart %>%
  filter(product_name == "Pink Lady Apples" | product_name == "Coffee Ice Cream") %>%
  select(product_name,product_id,order_dow,order_hour_of_day) %>%
  group_by(product_name, product_id, order_dow) %>%
  summarize(mean_hour_of_day = mean(order_hour_of_day,
                                    .groups=c(product_name, product_id, order_dow))) %>%
  pivot_wider(
    names_from=order_dow,
    values_from=mean_hour_of_day) %>%
  knitr::kable(digits=2)

```

## Problem 2




